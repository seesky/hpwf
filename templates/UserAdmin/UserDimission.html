<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>用户离职管理</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/css/layui.css" integrity="sha384-6DCQE4kq1XEy+8GJtI75G2uHzoFgsxH8KHCBGbQSDxWoW8WgknOcZ5IRCDYXMVZX" crossorigin="anonymous" />
    <style>
        body {
            background-color: #f5f5f5;
            padding: 16px;
        }

        .dimission-card {
            max-width: 720px;
            margin: 0 auto;
        }

        .dimission-card .layui-card-body {
            padding: 20px 24px 32px;
        }

        .dimission-section {
            margin-bottom: 24px;
        }

        .form-footer {
            text-align: center;
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <div class="layui-card dimission-card">
        <div class="layui-card-header">用户离职管理</div>
        <div class="layui-card-body">
            <form class="layui-form" lay-filter="dimissionForm" id="dimissionForm">
                <input type="hidden" id="Id" name="Id" />

                <fieldset class="layui-elem-field dimission-section">
                    <legend>用户信息</legend>
                    <div class="layui-field-box">
                        <div class="layui-form-item">
                            <label class="layui-form-label">登录名</label>
                            <div class="layui-input-block">
                                <input type="text" id="UserName" name="UserName" class="layui-input" readonly />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">姓名</label>
                            <div class="layui-input-block">
                                <input type="text" id="RealName" name="RealName" class="layui-input" readonly />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">岗位</label>
                            <div class="layui-input-block">
                                <input type="text" id="Duty" name="Duty" class="layui-input" readonly />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">默认角色</label>
                            <div class="layui-input-block">
                                <input type="text" id="RoleName" name="RoleName" class="layui-input" readonly />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">公司/单位</label>
                            <div class="layui-input-block">
                                <input type="text" id="CompanyName" name="CompanyName" class="layui-input" readonly />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">所在部门</label>
                            <div class="layui-input-block">
                                <input type="text" id="DepartmentName" name="DepartmentName" class="layui-input" readonly />
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="layui-elem-field dimission-section">
                    <legend>离职情况</legend>
                    <div class="layui-field-box">
                        <div class="layui-form-item">
                            <label class="layui-form-label">离职日期</label>
                            <div class="layui-input-block">
                                <input type="text" id="DimissionDate" name="DimissionDate" lay-verify="required" placeholder="请选择离职日期" autocomplete="off" class="layui-input" />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">是否离职</label>
                            <div class="layui-input-block">
                                <input type="checkbox" id="IsDimission" name="IsDimission" lay-skin="switch" lay-text="已离职|在职" />
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">离职原因</label>
                            <div class="layui-input-block">
                                <textarea id="DimissionCause" name="DimissionCause" lay-verify="required" class="layui-textarea" placeholder="请输入离职原因"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">离职去向</label>
                            <div class="layui-input-block">
                                <textarea id="DimissionWhither" name="DimissionWhither" class="layui-textarea" placeholder="请输入离职去向"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="form-footer">
                    <button type="button" class="layui-btn layui-btn-normal" id="btnSubmit">提交</button>
                    <button type="button" class="layui-btn layui-btn-primary" id="btnClose">关闭</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/layui.js" integrity="sha384-yK65FM0tElXkJuQJxyPny5n0xcgOjsLxU5C04h74hFSe48XLyAuz7wch4+CQ8yJn" crossorigin="anonymous"></script>
    <script src="/Content/Scripts/jquery-1.12.1.min.js"></script>
    <script src="/Content/Scripts/jQuery.Ajax.js"></script>
    <script src="/Content/Scripts/jQuery.cookie.js"></script>
    <script src="/Content/Scripts/csrf.js"></script>
    <script>
        layui.use(['form', 'laydate', 'layer'], function () {
            var form = layui.form;
            var laydate = layui.laydate;
            var layer = layui.layer;
            var $ = layui.$;

            laydate.render({
                elem: '#DimissionDate',
                trigger: 'click',
                type: 'date'
            });

            form.verify({
                required: function (value) {
                    if (!value) {
                        return '此项为必填项';
                    }
                }
            });

            $('#btnSubmit').on('click', function () {
                SubmitForm();
            });

            $('#btnClose').on('click', function () {
                CloseWindow();
            });

            window.BindPage = function (id) {
                $.ajaxjson('/Admin/FrameworkModules/UserAdmin/GetEntity/', 'key=' + id, function (data) {
                    if (data) {
                        var entity = typeof data === 'string' ? JSON.parse(data) : data;
                        setFormData(entity);
                        if (entity.isdimission) {
                            $('#btnSubmit').prop('disabled', true).addClass('layui-btn-disabled');
                        }
                    }
                });
            };

            function setFormData(data) {
                form.val('dimissionForm', {
                    Id: data.id || '',
                    UserName: data.username || '',
                    RealName: data.realname || '',
                    Duty: data.duty || '',
                    RoleName: data.rolename || '',
                    CompanyName: data.companyname || '',
                    DepartmentName: data.departmentname || '',
                    DimissionDate: data.dimissiondate ? data.dimissiondate.split(' ')[0] : '',
                    DimissionCause: data.dimissioncause || '',
                    DimissionWhither: data.dimissionwhither || ''
                });
                $('#IsDimission').prop('checked', data.isdimission === 1 || data.isdimission === true);
                form.render('checkbox');
            }

            window.SubmitForm = function () {
                var data = form.val('dimissionForm');
                if (!data.DimissionDate) {
                    layer.msg('请选择离职日期');
                    return false;
                }
                if (!data.DimissionCause) {
                    layer.msg('请输入离职原因');
                    return false;
                }
                if (!$('#IsDimission').prop('checked')) {
                    layer.msg('请确认是否已离职');
                    return false;
                }
                layer.confirm('确定将该用户设置为离职状态吗？', { icon: 3, title: '提示' }, function (index) {
                    var postData = {
                        Id: data.Id,
                        DimissionDate: data.DimissionDate,
                        IsDimission: $('#IsDimission').prop('checked') ? 1 : 0,
                        DimissionCause: data.DimissionCause,
                        DimissionWhither: data.DimissionWhither
                    };
                    $.ajaxjson('/Admin/FrameworkModules/UserAdmin/SetUserDimission/', postData, function (resp) {
                        if (resp.Success) {
                            layer.msg(resp.Message || '操作成功');
                            CloseWindow();
                        } else {
                            layer.msg(resp.Message || '操作失败');
                        }
                    });
                    layer.close(index);
                });
                return false;
            };

            window.CloseWindow = function () {
                var currTopTab = top.$('#tabs');
                var currtabTitle = currTopTab.tabs('getSelected').panel('options').title;
                currTopTab.tabs('close', currtabTitle);
            };
        });
    </script>
</body>
</html>
